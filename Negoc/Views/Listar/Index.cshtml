<<<<<<< HEAD
﻿@model IEnumerable<Negoc.Models.Producto>
=======
﻿@using Newtonsoft.Json;
@model IEnumerable<Negoc.ViewModels.ProductoList>
>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57

@{
    ViewData["Title"] = "Index";
}
<<<<<<< HEAD
<div class="alert  alert-primary">
    <a href="#" onclick="mostrarBarra();" class="btn btn-outline-primary">
        Categorias
    </a>
    <select class="btn btn-outline-primary " onchange="moverPag(0)" id="selectId">
        <option value="1">Menor precio</option>
        <option value="2">Mayor precio</option>
        <option value="3">A-Z</option>
        <option value="4">Z-A</option>
    </select>
</div>
<div class="alert   alert-info" style="display:inline-flex;width:100%">
    <div class="alert alert-primary alert-dismissible fade show" role="alert">
        Remeras
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        Talle
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="alert alert-secondary alert-dismissible fade show" role="alert">
        Genero
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
=======

<div style="padding:8px;display: inline-flex; width: 100%;">
    <div style="border-radius:4px;background-color: #cce5ff;flex:5;">
        <a href="#" style="line-height:2.0rem; margin:1rem; text-decoration:underline;color: #004085;font-size:1.2rem;" data-toggle="collapse" data-target="#demo">Filtrar</a>
    </div>

    <div style="border-radius:4px;background-color: #cce5ff;flex:1;display:inline-flex">
        <div >
            <div style="margin-right:4px; padding-top:6px;color:black">
                <span>Mostrar:</span>
            </div>
        </div>
        <select class="btn btn-secondary dropdown-toggle" onchange="moverPag(0)" id="selectPageSize">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57
    </div>
</div>


<<<<<<< HEAD
<div id="subCategorias" class="subcategorias">

    <div id="categorias">

    </div>
</div>
<div id="ContenedorProd" class="contenedor">

</div>

=======
<div id="demo" class="collapse" style="padding-left:8px;padding-right:8px;">
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark  " style="border-radius:8px;">
        <div class=" navbar-collapse show " id="navbarNavB">
            <ul class="navbar-nav">
                <li class="nav-item dropdown active " style="border-bottom:1px solid gray;border-radius:4px;">
                    <a class="nav-link dropdown-toggle" href="/Listar/" id="navbarDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Categoria
                    </a>
                    <div id="selectCategorias" class="dropdown-menu" aria-labelledby="navbarDropdown1">
                        <div id="categorias">

                        </div>
                    </div>
                </li>
                
                <li class="nav-item dropdown active " style="border-bottom:1px solid gray;border-radius:4px;">
                    <a class="nav-link dropdown-toggle" href="/Listar/" id="navbarDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Marca
                    </a>
                    <div id="selectMarcas" class="dropdown-menu" aria-labelledby="navbarDropdown1">

                    </div>
                </li>
                <li class="nav-item dropdown active " style="border-bottom:1px solid gray;border-radius:4px;">
                    <a class="nav-link dropdown-toggle" href="/Listar/" id="navbarDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Color
                    </a>
                    <div id="selectColores" class="dropdown-menu" aria-labelledby="navbarDropdown1">

                    </div>
                </li>
                <li class="nav-item dropdown active " style="border-bottom:1px solid gray;border-radius:4px;">
                    <a class="nav-link dropdown-toggle" href="/Listar/" id="navbarDropdown1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Precio
                    </a>
                    <div id="selectPrecio" class="dropdown-menu" aria-labelledby="navbarDropdown1">
                        <div class="container-fluid text-center">
                            <input type="number" id="precioD" value="0.00" placeholder="Mínimo" step=".1" />
                            <input type="number" id="precioH" value="0.00" placeholder="Máximo" step=".1" />
                            <hr />

                            <input type="button" name="name" value="Aplicar" class="btn btn-outline-primary" onclick="FiltrarPrecio();" />
                        </div>
                    </div>
                </li>
            </ul>

        </div>
        <ul class="nav justify-content-end">
            <li class="nav-item">
                <div style="display:inline-flex; padding:0px;">
                    <div style="padding-top:8px;color:white">
                        <span>Orden:</span>
                    </div>
                    <div style="margin:4px;max-width:160px;">
                        <select class="btn btn-secondary dropdown-toggle" onchange="moverPag(0)" id="selectId">
                            <option value="1">Menor precio</option>
                            <option value="2">Mayor precio</option>
                            <option value="3">A-Z</option>
                            <option value="4">Z-A</option>
                        </select>
                    </div>
                </div>
            </li>
        </ul>
    </nav>


</div> 
<div id="listaFiltros" style="border:1px solid silver; border-radius:8px;padding:4px;margin:8px  ">

</div>
<hr />

<div id="ContenedorProd" class="contenedor">

    @foreach (var item in Model)
    {
    <div class="item producto">
        <a href="/Listar/GetProductoList?ProductoId=@item.ProductoId">            
            <img class="producto-imagen" src="/Listar/GetImagePr/@item.ProductoId" alt="@item.Nombre" />
        </a>
        @if (item.DescuentoPorc > 0)
        {
            <span class="producto-oferta">Oferta</span>
        }
        <span class="producto-precio">@item.Precio.ToString("C0")</span>
        @if (item.DescuentoPorc > 0)
        {
            <span class="producto-off">-@item.DescuentoPorc%</span>
        }

        <div>
            <span class="producto-marca">@item.Marca</span>
        </div>
        <hr />
        <div>
            <p class="producto-descr">@item.Descripcion</p>
        </div>
        @if (item.EnvioGratis)
        {
            <div>
                <p class="producto-envio">Envio gratis</p>
            </div>
        }        
    </div>

    }
    
</div>

<div class="alert alert-primary">
    <ul class="pagination justify-content-md-center">
        <li class="page-item">
            <a class="page-link" href="javascript:moverPag(-1);" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        <li class="page-item">
            <input type="text" class="page-link" value="1" id="txtPageNumber" readonly style="width:36px;" />
        </li>
        <li class="page-item">
            <a class="page-link" href="javascript:moverPag(1);" id="pagSiguiente" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</div>

<input type="text" class="page-link"   id="txtPageCant" readonly style="width:36px;display:none" />

>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57

<script>

    window.addEventListener("load", window_onload);


<<<<<<< HEAD
    window.onscroll = function (ev) {
        if ((window.innerHeight + window.pageYOffset + 0) >= document.body.offsetHeight) { //mac window.pageYOffset+1
            console.log("you're at the bottom of the page");
        }
    };

    function mostrarBarra() {
        if (document.getElementById("subCategorias").classList[1] == null)
            document.getElementById("subCategorias").classList += " activo";
        else
            document.getElementById("subCategorias").classList = "subcategorias";
    }

    function selectOrden(e) {



        

    }

    function moverPag(n) {

=======

    function FiltrarPrecio() {
        AgregarFiltro("Precio", 1);
        moverPag(0);
    }
    function AgregarFiltro(Nombre, valor) {

        if (valor == 0 || valor == null) return;

        var cont = document.getElementById("listaFiltros");
        var btn = document.createElement("button");
        var spA = document.createElement("span");
        var spB = document.createElement("span");

        var b = document.getElementById("filtro" + Nombre);
        if(b) b.remove();

        btn.type = "button";
        btn.classList = "btn btn-light";
        btn.name = valor;
        btn.id = "filtro" + Nombre;
        spA.innerText = Nombre;
        spB.innerText = "X";
        spB.classList = "badge badge-light";
        spB.style = "border:1px solid silver;border-radius:6px;margin:4px";
        btn.onclick = function (e) { Cerrar(e); }

        btn.appendChild(spA);
        btn.appendChild(spB);
        cont.appendChild(btn);

    }
    function Cerrar(e) {
        e.currentTarget.remove();
        moverPag(0);
    }
    function getFromQry(e) {

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        return urlParams.get(e) == undefined ? 0 : urlParams.get(e);
    }

    function getQryVal() {
        //Leer todos los param y cargarlos en filtros
>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        var catId = urlParams.get('CategoriaId');
        var genId = urlParams.get('GeneroId');
<<<<<<< HEAD
        var pagNum = urlParams.get('PageNumber');
        var pagSiz = urlParams.get('PageSize');
        var tipoOrden = document.getElementById("selectId").value; //urlParams.get('TipoOrden');

=======
        var marcaId = urlParams.get('MarcaId');
        var colorId = urlParams.get('ColorId');
        var precioD = urlParams.get('PrecioD');
        var precioH = urlParams.get('PrecioH');
        var descripcion = urlParams.get('Descripcion');
        var pagNum = urlParams.get('PagNumero');
        var pagSiz = urlParams.get('PagCantidad');
        var tipoOrden = urlParams.get('TipoOrden');

        document.getElementById("precioD").value = precioD;
        document.getElementById("precioH").value = precioH;
        document.getElementById("txtPageNumber").value = pagNum;
        document.getElementById("selectPageSize").value = pagSiz;
        document.getElementById("selectId").value = tipoOrden;

        AgregarFiltro("Categoria", catId);
        AgregarFiltro("Genero", genId);
        AgregarFiltro("Marca", marcaId);
        AgregarFiltro("Color", colorId);
        AgregarFiltro("Precio", precioD);
        AgregarFiltro("Descripcion", descripcion);

    }
    function moverPag(n) {

        var pagNum = document.getElementById("txtPageNumber").value;
>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57
        pagNum = parseInt(pagNum) + n;

        if (pagNum <= 0) return;

<<<<<<< HEAD
        var urlProd = "/Listar/GetProductos" + getQryNue(catId, genId, pagNum, pagSiz, tipoOrden);

        $.ajax({
            url: urlProd,
            method: "GET",
            dataType: 'json'
        }).then(function (data) {
            var productos = JSON.parse(data);
            if (productos.length > 0) {

                LimpiarProd();
                CargarProd(productos);
            }
            else {
                pagNum -= n;
            }

            queryStringNue = getQryNue(catId, genId, pagNum, pagSiz, tipoOrden);
            setUrl(queryStringNue);
            document.getElementById("txtPageNumber").value = pagNum;
        });

    }
    function setUrl(queryStringNue) {

        var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + queryStringNue;
        window.history.pushState('', '', newurl);

    }
    function getQryNue(catId, genId, pagNum, pagSiz, tipoOrden) {

        var queryStringNue = "?CategoriaId=" + catId + "&GeneroId=" + genId + "&PageNumber=" + pagNum + "&PageSize=" + pagSiz + "&TipoOrden=" + tipoOrden;
        return queryStringNue;
    }

    function window_onload() {
        //document.getElementById("txtPageNumber").value = "1";

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        var urlProd = "";

        var catId = urlParams.get('CategoriaId');
        var genId = urlParams.get('GeneroId');
        var pagNum = 1;
        var pagSiz = 3;

        if (catId != null)
            urlProd = "/Listar/GetProductosCat?CategoriaId=" + catId;
        if (genId != null)
            urlProd = "/Listar/GetProductosCatGen?CategoriaId=" + catId + "&GeneroId=" + genId;

        urlProd = "/Listar/GetProductos?CategoriaId=" + catId + "&GeneroId=" + genId + "&PageNumber=" + pagNum + "&PageSize=" + pagSiz;

        //GetProductos
        $.ajax({
            url: urlProd,
            method: "GET",
            dataType: 'json'
        }).then(function (data) {
            var productos = JSON.parse(data);
            CargarProd(productos);
        });

=======
        document.getElementById("txtPageNumber").value = pagNum;

        var urlProd = "/Listar/GetProductos" + getQryNue(1);
        var cant = @Model.Count();

        window.location.href = urlProd;


    }
    //CategoriaId, GeneroId, MarcaId, ColorId, PrecioD, PrecioH, Descripcion, PagNumero, PagCantidad, TipoOrden
    function getQryNue(e) {
        // 1  es todos
        //get query con todos los param
        //get query sin pag numero pag cant

        var catId = document.getElementById("filtroCategoria") != null ? document.getElementById("filtroCategoria").name : 0;
        var genId = document.getElementById("filtroGenero") != null ? document.getElementById("filtroGenero").name : 0;
        var marcaId = document.getElementById("filtroMarca") != null ? document.getElementById("filtroMarca").name : 0;
        var colorId = document.getElementById("filtroColor") != null ? document.getElementById("filtroColor").name : 0;
        var descripcion = document.getElementById("filtroDescripcion") != null ? document.getElementById("filtroDescripcion").name : '';
        var precioD = 0;
        var precioH = 0;

        if (document.getElementById("filtroPrecio")) {
            precioD = document.getElementById("precioD").value;
            precioH = document.getElementById("precioH").value;
        }

        var tipoOrden = document.getElementById("selectId").value;
        var pagNum = document.getElementById("txtPageNumber").value;
        var pagSiz = document.getElementById("selectPageSize").value ;
        var queryStringNue = '';

        if(e == 1)
            queryStringNue = "?CategoriaId=" + catId + "&GeneroId=" + genId + "&MarcaId=" + marcaId + "&ColorId=" + colorId + "&PrecioD=" + precioD + "&PrecioH=" + precioH + "&Descripcion=" + descripcion + "&PagNumero=" + pagNum + "&PagCantidad=" + pagSiz + "&TipoOrden=" + tipoOrden;
        else
            queryStringNue = "?CategoriaId=" + catId + "&GeneroId=" + genId + "&MarcaId=" + marcaId + "&ColorId=" + colorId + "&PrecioD=" + precioD + "&PrecioH=" + precioH + "&Descripcion=" + descripcion + "&TipoOrden=" + tipoOrden;

        return queryStringNue;
    }
    function reempQry(qry, reem) {

        var str = qry.toString();
        var ini = str.indexOf(reem);
        var fin = str.indexOf("&", ini);
        return str.substring(0, ini) + reem + "0" + str.substring(fin);
    }
    function getMarcas() {

        var res = reempQry(getQryNue(), "MarcaId=");
        var urlg = "/Listar/GetMarcas" + res;

        $.ajax({
            url: urlg,
            type: 'Get',
            dataType:'json'
        }).then(function (data){
            var arr = JSON.parse(data);
            var select = document.getElementById("selectMarcas");

            arr.forEach(
                (elem, index, array) => {
                    var op = document.createElement("a");
                    op.href = "javascript:void(0)";
                    op.className = "dropdown-item";
                    op.innerText = elem.Nombre;
                    op.onclick = () => { AgregarFiltro("Marca", elem.MarcaId); moverPag(0); }
                    select.appendChild(op);
                });

        });
    }

    function getColores() {

        var res = reempQry(getQryNue(), "ColorId=");
        var urlg = "/Listar/GetColores" + res;

        $.ajax({
            url: urlg,
            type: 'Get',
            dataType: 'json'
        }).then(function (data) {
            var arr = JSON.parse(data);
            var select = document.getElementById("selectColores");

            arr.forEach(
                (elem, index, array) => {
                    var op = document.createElement("a");
                    op.href = "javascript:void(0)";
                    op.className = "dropdown-item";
                    op.innerText = elem.Nombre;
                    op.onclick = () => { AgregarFiltro("Color", elem.ColorId); moverPag(0); }
                    select.appendChild(op);
                });

        });
    }

    function window_onload() {

        getQryVal();
        getMarcas();
        getColores();
        getCats();


        //-----
        $.ajax({
            url: "/Listar/GetProductosCantPag" + getQryNue(1),
            type: 'Post',
            dataType: 'json'
        }).then(function (data) {

            document.getElementById("txtPageCant").value = data;

            if (parseInt(document.getElementById("txtPageNumber").value) == 
                parseInt(document.getElementById("txtPageCant").value))

                document.getElementById("pagSiguiente").style.visibility = 'hidden';

        });
    }

    function getCats() {
>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57
        $.ajax(
            {
                url: "/Listar/GetCategorias?CategoriaId=0&NivelId=5",
                method: "GET",
                dataType: 'json'
            }
        ).then(function (data) {
            var res = JSON.parse(data);
            var contain = document.getElementById("categorias");
            res.forEach((elem, index, array) => {
                if (elem.NivelId == 1) {
                    var divR = document.createElement("div");
                    divR.id = elem.CategoriaId;

                    var spText = document.createElement("span");
                    spText.innerText = elem.Nombre;
                    spText.addEventListener('click', function (e) { e.cancelBubble = true; CategoriaClick(e); });
                    var spIco = document.createElement("span");
                    spIco.innerHTML = "|+|";
                    spIco.className = "categoria-icono";
                    spIco.addEventListener('click', function (e) { e.cancelBubble = true; disp(e); });

                    divR.appendChild(spIco);
                    divR.appendChild(spText);

                    contain.appendChild(divR);
                }
                else {
                    var nodo = document.getElementById(elem.ParentId);
                    if (nodo == null) { //no existe
                    }
                    else {
                        var divR = document.createElement("div");
                        divR.style.display = "none";
                        divR.id = elem.CategoriaId;
                        nodo.appendChild(divR);

                        var spText = document.createElement("span");
                        spText.innerText = elem.Nombre;
                        spText.addEventListener('click', function (e) { e.cancelBubble = true; CategoriaClick(e); });
                        var spIco = document.createElement("span");
                        spIco.innerHTML = "|+|";
                        spIco.className = "categoria-icono";
                        spIco.addEventListener('click', function (e) { e.cancelBubble = true; disp(e); });

                        divR.appendChild(spIco);
                        divR.appendChild(spText);

                    }
                }
            });
        });
    }

    function disp(e) {

        if (e.target.innerHTML.indexOf("+") < 0)
            e.target.innerHTML = e.target.innerHTML.replace("-", "+");
        else
            e.target.innerHTML = e.target.innerHTML.replace("+", "-");

        e.target.parentElement.childNodes.forEach((elem, index, array) => {
            if (elem.tagName == "DIV") {
                if (elem.style.display != "none")
                    elem.style.display = "none";
                else
                    elem.style.display = "block";
            }
        });
    }
<<<<<<< HEAD
    function CategoriaClick(e) {

        $.ajax({
            url: "/Listar/GetProductosCat?CategoriaId=" + e.target.parentElement.id,
            method: "GET",
            dataType: 'json'
        }).then(function (data) {
            mostrarBarra();
            var productos = JSON.parse(data);
            CargarProd(productos);
        });
    }
    function LimpiarProd() {
        var contain = document.getElementById("ContenedorProd");
        while (contain.firstElementChild)
            contain.removeChild(contain.firstElementChild);
    }
    function CargarProd(lista) {

        var contain = document.getElementById("ContenedorProd");
        lista.forEach((elem, index, array) => {

            var divProd = document.createElement("div");
            divProd.classList = "item producto";
            var imagen = document.createElement("img");
            var oferta = document.createElement("span");
            var precio = document.createElement("span");
            var off = document.createElement("span");
            var envio = document.createElement("span");
            var descr = document.createElement("span");

            imagen.className = "producto-imagen";
            imagen.src = "/Listar/GetImagePr/" + elem.ProductoId;
            oferta.className = "producto-oferta";
            oferta.innerText = "Oferta";
            precio.className = "producto-precio";
            precio.innerText = elem.PrecioStr;
            off.className = "producto-off";
            off.innerText = "20%";
            envio.className = "producto-off";
            envio.innerText = "Envio gratis";
            descr.className = "producto-descr";
            descr.innerText = elem.Nombre;

            divProd.appendChild(imagen);
            divProd.appendChild(oferta);
            divProd.appendChild(precio);
            divProd.appendChild(off);
            divProd.appendChild(document.createElement("br"));
            divProd.appendChild(envio);
            divProd.appendChild(document.createElement("br"));
            divProd.appendChild(descr);

            contain.appendChild(divProd);

        });
    }
=======

    function CategoriaClick(e) {

        var catId = e.target.parentElement.id;
        AgregarFiltro("Categoria", catId);
        moverPag(0);
    }



>>>>>>> 732283587911371be4fc8312a3aa766a48e3ce57


</script>

